# ENTRADA-PRO (PRO painel) — snippet incluído dentro do server { } do paineljorge.duckdns.org
# 1) Site (HTML/CSS/JS)
location = / { return 302 /full.html; }
location ~* \.(html|css|js)$ {
  root /var/www/entrada-pro;
  try_files $uri =404;
  add_header Cache-Control "no-store" always;
}

# 2) API (proxy para Node)
location ^~ /api/ {
  proxy_pass http://127.0.0.1:8090;
  proxy_http_version 1.1;
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_connect_timeout 2s;
  proxy_read_timeout 10s;
  proxy_send_timeout 10s;

  # Nunca deixar 502 aparecer no navegador:
  error_page 502 503 504 =200 /api/_down.json;
}

location = /api/_down.json {
  default_type application/json;
  return 200 '{"ok":false,"error":"upstream_down","hint":"API/Worker fora do ar ou Nginx apontando para porta errada"}';
}
