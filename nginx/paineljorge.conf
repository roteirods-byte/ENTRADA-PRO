# paineljorge.duckdns.org - CONFIG OFICIAL (FULL/TOP10/AUDIT)
# - Corrige CERTIFICADO (CN) e elimina 502 por proxy errado
# - Serve site estático (full.html/top10.html/audit.html) e /api/* via 8095
#
# Requisitos:
#   Cert: /etc/letsencrypt/live/paineljorge.duckdns.org/{fullchain.pem,privkey.pem}
#   API:  http://127.0.0.1:8095  (entrada-pro-api)
#   Site: /home/roteiro_ds/ENTRADA-PRO/site  (contém full.html/top10.html/audit.html)

server {
  listen 80;
  server_name paineljorge.duckdns.org;

  location ^~ /.well-known/acme-challenge/ { auth_basic off; }

  return 301 https://$host$request_uri;
}

server {
  listen 443 ssl;
  server_name paineljorge.duckdns.org;

  ssl_certificate     /etc/letsencrypt/live/paineljorge.duckdns.org/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/paineljorge.duckdns.org/privkey.pem;

  root /home/roteiro_ds/ENTRADA-PRO/site;

  location /api/ {
    proxy_pass http://127.0.0.1:8095;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  location = / { return 302 /full.html; }
  location = /full.html  { try_files /full.html  =404; }
  location = /top10.html { try_files /top10.html =404; }
  location = /audit.html { try_files /audit.html =404; }

  location /assets/ { try_files $uri =404; }

  location / { try_files $uri =404; }
}
